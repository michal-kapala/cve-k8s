# Overview

A local Kubernetes cluster for [cve-docker](https://github.com/michal-kapala/cve-docker) deployment.

# Prerequisites

- [Docker](https://www.docker.com/)
- [kind](https://kind.sigs.k8s.io/)
- [kubectl](https://kubernetes.io/docs/tasks/tools/#kubectl)
- [Golang](https://go.dev/) (optional for `kind` installation)

# How to run

1. Create a default `kind` cluster and health-check it:

```
kind create cluster --config=kind-cluster.yaml
kubectl version
```

2. Load local [Docker images](https://github.com/michal-kapala/cve-docker) with `kind`:
```
kind load docker-image cve_pocketbase
kind load docker-image cve_auth
kind load docker-image cve_cve
kind load docker-image cve_t3
```

3. Create pods:
```
kubectl apply -f cve-pocketbase-pod.yaml
kubectl apply -f cve-auth-pod.yaml
kubectl apply -f cve-cve-pod.yaml
kubectl apply -f cve-t3-pod.yaml
```

4. Create services:
```
kubectl apply -f cve-pocketbase-svc.yaml
kubectl apply -f cve-auth-svc.yaml
kubectl apply -f cve-cve-svc.yaml
kubectl apply -f cve-t3-svc.yaml
```

5. Port-forward the containers if needed:

- PocketBase
```
kubectl port-forward cve-pocketbase 8090:8090
```
- [cve-auth](https://github.com/michal-kapala/cve-dashboard-auth)
```
kubectl port-forward cve-auth 50051:50051
```
- [cve-cve](https://github.com/michal-kapala/cve-dashboard-service)
```
kubectl port-forward cve-cve 50052:50052
```
- [cve-t3](https://github.com/michal-kapala/cve-dashboard)
```
kubectl port-forward cve-t3 3000:3000
```
